# 1.OSインストール
http://qiita.com/yujiod/items/dc154120c4df2e938111  
　  
- - - 
　  
## VPSの管理画面で

### 1.coreOSのISOをダウンロードしておく
https://coreos.com/os/docs/latest/booting-with-iso.html  

### 2.OSインストールの中から「ISOイメージインストール」を選択
(1)発行されたSFTPアカウントで指定ディレクトリにISOイメージをアップロード  
(2)管理画面からインストール(/isoのisoファイルから起動してる状態？)  
　  
　  
- - - 
　  
## ssh接続できるように
```cmd
$ ssh root@IPアドレス
```

### エラー → 「ssh: connect to host xxx.xxx.xxx.xxx port xxx: Operation timed out」
coreOSは初期設定でネットワーク周りが設定されていない
　  
### coreOSのSSH接続のための変更
#### IPアドレスとサブネットマスクを設定
```cmd
# コントロールパネルに記載の値を設定する
$ sudo ifconfig eth0 xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx
$ sudo route add default gw xxx.xxx.xxx.xxx
# coreOSにログインしている「core」アカウントのパスワード変更
$ sudo passwd core
```
#### iTerm2でssh接続してみる
```
$ ssh core@xxx.xxx.xxx.xxx
# つながったらコンソールとｸﾞｯﾊﾞｲ＼(^0^)／
```
##### ※ssh-keyの保存場所、編集：接続先サーバの情報(フィンガープリント)
```
$ sudo vim ~/.ssh/known_hosts
```
　  
- - - 
　  
## coreOSの本インストール
[cloud-config.yml](https://github.com/IsabellaAzu/memo/blob/master/vps/cloud-config.md)を用意 （※[syntax check](https://coreos.com/validate/)）  
[書き方：公式](https://coreos.com/os/docs/latest/cloud-config.html)  

#### パスワードハッシュの作り方
ｓｓｈキーを使用しないでsshのパスワード認証する場合に使用  
http://think-t.hatenablog.com/entry/20140111/p1  

#### 鍵の作成
```
# アクセスしたい端末で生成
$ sudo ssh-keygen -t rsa
# 表示
$ sudo cat ~/.ssh/id_rsa.pub
# 編集
$ sudo vim cloud-config.yml
```

### DNSサーバの設定
/etc/systemd/network下に[static.network](https://github.com/IsabellaAzu/memo/blob/master/vps/static.network)ファイルを置く  
http://qiita.com/nobwak/items/02ff9b5929935ef9c074  

```
$ sudo vim /etc/systemd/network/static.network
------------------------------------------------
# 先ほどのcloud-config.ymlに記載の内容と同じものを記載
        [Match]
        Name=eth0
        [Network]
        Address=xxx.xxx.xxx.xxx/23
        Gateway=xxx.xxx.xxx.xxx
        DNS=xxx.xxx.xxx.xxx
```

### ネットワークの再設定(再起動ではない、ファイルの再読み込みかな)
```
# /etc/resolv.confのnameserverの項目にプライマリDNSの値がセットされる
$ sudo systemctl restart systemd-networkd
```

### インストール
```
$ sudo coreos-install -d /dev/vda -C stable -c cloud-config.yml
------------------------------------------------
Downloadingが始まり、Success!が表示されれば、インストール完了！
```

### sftpでアップロードした、/ｉｓｏ内のｉｓｏファイルの削除
ｉｓｏファイルでのブートをさせないために。その後、
```
$ reboot
```

#### さくらのコンソールで、ｓｓｈｄの再起動　→ ssh接続できるようになる
```
$ systemctl restart sshd.service
```
* sshキーを生成した端末からは、パスワード認証なくssh接続ができる  
* sshキーの無い端末からssh接続すると、ハッシュ値のパスワード認証になる  
* [port番号の変更](https://coreos.com/os/docs/latest/customizing-sshd.html#changing-the-sshd-port-1)

- - - 
　  
## index
<a href="./readme.md">readme.md</a>  
1.OSインストール  
<a href="./2.セキュリティ設定.md">2.セキュリティ設定</a>  
<a href="./3.一般ユーザー追加.md">3.一般ユーザー追加</a>  
<a href="./4.SSH接続の設定変更.md">4.SSH接続の設定変更</a>  
<a href="./5.ファイアウォールの設定.md">5.ファイアウォールの設定</a>  



